# Milestone v2.0.2: Type Generator Fixes

**Status:** SHIPPED 2026-01-17
**Phases:** 22.4-22.9
**Total Plans:** 6

## Overview

Fix type generation issues discovered during adotta-animali port to improve TypeScript integration reliability.

**Source:** [.planning/backlog/adotta-animali-issues.md](../backlog/adotta-animali-issues.md)

## Phases

### Phase 22.4: Type Generator Fixes

**Goal**: Fix missing shared.ts imports, type re-exports, and serde attribute handling in generated TypeScript files
**Depends on**: v2.0.1 complete

Issues addressed:
- #1 Type Generator: Missing Imports from shared.ts (High)
- #5 Type Re-exports Not Generated (Medium)
- #8 Serde rename_all Causes Silent Frontend Failures (High)

Plans:
- [x] 22.4-01: Fix serde attributes, shared.ts imports, type re-exports

**Key changes:**
- Added SerdeCase enum for rename_all handling
- Per-field #[serde(rename)] takes precedence over struct-level
- Parse shared.ts and generate imports for referenced types
- Generate re-exports for all shared.ts types (--no-reexports to disable)

### Phase 22.5: Prop Naming Collisions

**Goal**: Resolve InertiaProps naming collisions and duplicate routes.ts entries
**Depends on**: Phase 22.4

Issues addressed:
- #3 InertiaProps Naming Collisions (High)
- #2 Type Generator: Duplicate Properties in routes.ts (Medium)

Plans:
- [x] 22.5-01: Module path tracking and namespaced type generation

**Key changes:**
- Module path uses :: separator (shelter::applications)
- Namespaced names use PascalCase (ShelterApplicationsShowProps)
- Controller extraction joins with underscore (shelter_dashboard)

### Phase 22.6: Contract Validation CLI

**Goal**: Expose MCP validate_contracts tool as a CLI command with structural nesting validation for CI integration
**Depends on**: Phase 22.5

Issues addressed:
- #4 No Props Contract Validation CLI (Medium)
- #9 Nested vs Flat Props Structure Mismatch (High)

Plans:
- [x] 22.6-01: Expose MCP validate_contracts as CLI command with structural nesting validation

**Key changes:**
- Added `ferro validate:contracts` command
- Structural nesting validation for inline TypeScript objects
- JSON output format with --json flag
- Exit code 1 on failures for CI integration

### Phase 22.7: DateTime Handling

**Goal**: Improve datetime field handling with proper types instead of strings
**Depends on**: Phase 22.6

Issues addressed:
- #6 Inconsistent Date/Time Field Handling (Low)

Plans:
- [x] 22.7-01: Add chrono datetime type support to TypeScript generator

**Key changes:**
- Added DateTime variant to RustType enum
- Recognizes: DateTime, NaiveDateTime, NaiveDate, NaiveTime, DateTimeUtc, DateTimeLocal, Date, Time
- All datetime types map to TypeScript "string" (ISO8601 serialization)

### Phase 22.8: Nested Types Generation

**Goal**: Generate TypeScript interfaces for all nested/referenced types used in InertiaProps, not just the page props themselves
**Depends on**: Phase 22.7

Issues addressed:
- Type Generator Missing Nested Types (High) - Props reference undefined types like UserInfo, MenuSummary, TenantInfo

Plans:
- [x] 22.8-01: Recursive nested type resolution and generation

**Key changes:**
- Added SerializeStructVisitor for nested type scanning
- Fixed-point iteration for recursive type resolution
- Finds all #[derive(Serialize)] structs referenced by props

### Phase 22.9: ValidationErrors Type

**Goal**: Add dedicated ValidationErrors type that generates proper TypeScript Record<string, string[]> instead of unknown
**Depends on**: Phase 22.8

Issues addressed:
- ValidationErrors should have a dedicated type (Medium) - Avoids manual type casts in frontend forms

Plans:
- [x] 22.9-01: ValidationErrors type handling

**Key changes:**
- ValidationErrors maps to Record<string, string[]>
- Works with both ValidationErrors and ferro::ValidationErrors paths

---

## Milestone Summary

**Key Decisions:**

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Serde case handling | Enum with apply() method | Type-safe, exhaustive pattern matching |
| Per-field vs struct-level | Field rename takes precedence | Matches serde's actual behavior |
| Import generation | Only referenced types | Keeps imports minimal and relevant |
| Re-export generation | All shared.ts types | Convenience for component imports |
| Module path format | :: separator | Consistent with Rust module paths |
| Namespaced names | PascalCase | Clean TypeScript interface names |
| Nested type scanning | SerializeStructVisitor | Finds #[derive(Serialize)] structs by name |
| ValidationErrors mapping | Direct to Record | Maps to Record<string, string[]> |
| DateTime variant | No inner type | All chrono types serialize to ISO8601 strings |

**Issues Resolved:**
- #1 Missing shared.ts imports
- #2 Duplicate routes.ts entries
- #3 InertiaProps naming collisions
- #4 No props contract validation CLI
- #5 Type re-exports not generated
- #6 Inconsistent datetime handling
- #8 Serde rename_all silent failures
- #9 Nested vs flat props structure mismatch
- ValidationErrors type handling

**Issues Deferred:**
- #7 Missing Animal Images Relationship (Eager Loading) - Significant feature requiring architectural work

**Technical Debt Incurred:**
- None

---

_For current project status, see .planning/ROADMAP.md_
