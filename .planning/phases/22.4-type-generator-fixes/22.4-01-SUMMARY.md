---
phase: 22.4-type-generator-fixes
plan: 01
status: complete
started: 2026-01-17
completed: 2026-01-17
---

# Phase 22.4-01 Summary: Type Generator Fixes

## Objective

Fix the type generator to properly handle serde attributes, shared.ts imports, and type re-exports.

## Tasks Completed

### Task 1: Parse serde rename_all attributes

**Files modified:**
- `ferro-cli/src/commands/generate_types.rs`
- `ferro-mcp/src/tools/list_props.rs`

**Changes:**
- Added `SerdeCase` enum with variants: `None`, `CamelCase`, `SnakeCase`, `PascalCase`, `ScreamingSnakeCase`, `KebabCase`
- Added `serde_rename_all: Option<SerdeCase>` field to `InertiaPropsStruct`
- Added `serde_rename: Option<String>` field for per-field overrides
- Implemented `parse_serde_rename_all_value()` to extract rename strategy from `#[serde(rename_all = "...")]`
- Implemented `parse_serde_rename_value()` to extract per-field renames from `#[serde(rename = "...")]`
- Added `apply_field_rename()` to transform field names based on serde configuration
- Per-field `#[serde(rename = "customName")]` takes precedence over struct-level `rename_all`

**Tests added:**
- `test_serde_case_from_str` - Parse serde case strings
- `test_serde_case_apply` - Apply case transformations
- `test_parse_serde_rename_all_value` - Extract rename_all from attributes
- `test_parse_serde_rename_value` - Extract per-field renames
- `test_apply_field_rename` - Field renaming with precedence
- `test_generate_typescript_with_serde` - End-to-end TypeScript generation
- `test_snake_to_camel`, `test_snake_to_pascal` - Case conversion helpers

### Task 2: Parse shared.ts and generate imports

**Files modified:**
- `ferro-cli/src/commands/generate_types.rs`
- `ferro-mcp/src/tools/generate_types.rs`

**Changes:**
- Added `parse_shared_types(project_path: &Path) -> HashSet<String>` to extract exported types from `frontend/src/types/shared.ts`
- Added `collect_referenced_types(structs: &[InertiaPropsStruct]) -> HashSet<String>` to find custom types in props
- Added `collect_custom_types(rust_type: &RustType, types: &mut HashSet<String>)` for recursive type traversal
- Modified `generate_typescript_with_options()` to generate import statements
- Types defined in the same file are not imported (prevents self-imports)

**Generated output example:**
```typescript
import type { Animal, Rifugio } from './shared';
```

**Tests added:**
- `test_collect_referenced_types` - Extract type references from props
- `test_generate_typescript_with_imports` - Import statement generation

### Task 3: Generate type re-exports

**Files modified:**
- `ferro-cli/src/commands/generate_types.rs`
- `ferro-cli/src/main.rs`
- `ferro-mcp/src/tools/generate_types.rs`

**Changes:**
- Added re-export block generation after imports for ALL types from shared.ts
- Added `--no-reexports` CLI flag to disable re-export generation
- Added `generate_types_to_file_with_options()` for full control over generation
- Updated `run()` signature to accept `no_reexports` parameter

**Generated output example:**
```typescript
import type { Animal, Rifugio } from './shared';

// Re-exports from shared.ts for convenience
export type { Animal, Rifugio, User, ... } from './shared';

export interface DashboardProps {
  // ...
}
```

## Commits

1. `feat(generate-types): add serde rename_all and per-field rename support` - Task 1
2. `feat(generate-types): parse shared.ts and generate type imports` - Task 2
3. `feat(generate-types): add re-export generation and --no-reexports flag` - Task 3

## Verification

- [x] `cargo build --all` succeeds
- [x] `cargo test -p ferro-cli -p ferro-mcp` passes (176 tests)
- [x] `cargo clippy --all -- -D warnings` passes
- [x] `cargo fmt --check` passes

## Key Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Serde case handling | Enum with `apply()` method | Type-safe, exhaustive pattern matching |
| Per-field vs struct-level | Field rename takes precedence | Matches serde's actual behavior |
| Import generation | Only referenced types | Keeps imports minimal and relevant |
| Re-export generation | All shared.ts types | Convenience for component imports |
| Re-export control | `--no-reexports` flag | Flexibility for projects that don't want re-exports |

## Files Changed

- `ferro-cli/src/commands/generate_types.rs` - Core type generation logic
- `ferro-cli/src/main.rs` - CLI flag for --no-reexports
- `ferro-mcp/src/tools/list_props.rs` - Props parsing with serde support
- `ferro-mcp/src/tools/generate_types.rs` - MCP tool with matching functionality
