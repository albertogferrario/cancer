---
phase: 22.4-type-generator-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - ferro-cli/src/commands/generate_types.rs
  - ferro-mcp/src/tools/list_props.rs
  - ferro-mcp/src/tools/generate_types.rs
autonomous: true
---

<objective>
Fix type generator to properly handle serde attributes, shared.ts imports, and type re-exports.

Purpose: The `ferro generate-types` command and MCP `generate_types` tool produce TypeScript with:
- Field names using snake_case even when Rust uses `#[serde(rename_all = "camelCase")]`
- No imports from `shared.ts` for referenced types
- No re-exports for types that components need

Output:
- Type generator respects serde rename attributes
- Generated TypeScript imports types from shared.ts when referenced
- Generated TypeScript re-exports shared types for component convenience
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/backlog/adotta-animali-issues.md
@ferro-cli/src/commands/generate_types.rs
@ferro-mcp/src/tools/list_props.rs
@ferro-mcp/src/tools/generate_types.rs
</context>

<tasks>
<task type="auto">
  <name>Task 1: Parse serde rename_all attributes</name>
  <files>ferro-cli/src/commands/generate_types.rs, ferro-mcp/src/tools/list_props.rs</files>
  <action>
  Extend the InertiaProps parsing to detect `#[serde(rename_all = "camelCase")]` and similar attributes on structs.

  In CLI (generate_types.rs):
  1. Add `SerdeCase` enum: `None, CamelCase, SnakeCase, PascalCase, ScreamingSnakeCase, KebabCase`
  2. Add `rename_all: SerdeCase` field to `InertiaPropsStruct`
  3. In `has_inertia_props_derive()` or a new helper, also check for `#[serde(rename_all = "...")]` attribute
  4. Parse the rename strategy from the attribute value
  5. In `rust_type_to_ts()` or `generate_typescript()`, apply the renaming transformation to field names
  6. Also parse `#[serde(rename = "...")]` on individual fields to override

  In MCP (list_props.rs):
  1. Add `serde_rename_all: Option<String>` field to `PropsStruct`
  2. Update regex parsing in `find_inertia_props_structs()` to detect `#[serde(rename_all = "...")]` before the struct
  3. Add `serde_rename: Option<String>` field to `PropsField` for per-field renames
  4. In `generate_typescript_interface()`, apply the renaming transformation

  Use a helper function `apply_serde_rename(field_name: &str, rename_all: Option<&str>) -> String`:
  - "camelCase" -> snake_to_camel
  - "PascalCase" -> snake_to_pascal
  - "kebab-case" -> snake_to_kebab
  - "SCREAMING_SNAKE_CASE" -> to_screaming_snake
  - None or "snake_case" -> unchanged

  AVOID: Changing the validation contract tool for now (Phase 22.6 will handle that).
  </action>
  <verify>
  Create a test struct with `#[derive(InertiaProps)] #[serde(rename_all = "camelCase")]` and verify:
  - Generated TypeScript uses camelCase field names
  - `cargo test -p ferro-cli` passes
  - `cargo test -p ferro-mcp` passes
  </verify>
  <done>
  - InertiaProps structs with `#[serde(rename_all = "camelCase")]` generate TypeScript with camelCase fields
  - Per-field `#[serde(rename = "customName")]` overrides are respected
  - Tests pass for both CLI and MCP crates
  </done>
</task>

<task type="auto">
  <name>Task 2: Parse shared.ts and generate imports</name>
  <files>ferro-cli/src/commands/generate_types.rs, ferro-mcp/src/tools/generate_types.rs</files>
  <action>
  Add logic to detect types referenced in generated interfaces and import them from shared.ts.

  1. Add a new function `parse_shared_types(project_path: &Path) -> HashSet<String>`:
     - Look for `frontend/src/types/shared.ts` (or configurable path)
     - Parse with regex to extract `export interface X`, `export type X`, `export enum X`
     - Return set of exported type names

  2. Add a new function `collect_referenced_types(structs: &[InertiaPropsStruct]) -> HashSet<String>`:
     - Walk all fields recursively
     - Collect `RustType::Custom(name)` values
     - Return unique type names referenced

  3. In `generate_typescript()`:
     - Call both functions
     - Compute intersection: types referenced that exist in shared.ts
     - Generate import statement at top of file:
       ```typescript
       import type { Type1, Type2, ... } from './shared';
       ```
     - Skip types that are defined within the same file (other InertiaProps structs)

  4. Similarly update MCP generate_types.rs to use the same logic (can share via list_props or inline)

  AVOID: Hardcoding the shared.ts path - make it configurable via CLI flag or convention.
  WHY: Projects may have different TypeScript folder structures.
  </action>
  <verify>
  - Create test with InertiaProps struct referencing a type from shared.ts
  - Verify generated inertia-props.ts has `import type { ... } from './shared'`
  - Verify types defined in same file are not imported
  - `cargo build --all` succeeds
  </verify>
  <done>
  - Generated TypeScript imports referenced types from shared.ts
  - Types defined in same generated file are not imported
  - Import statement appears at top of file
  </done>
</task>

<task type="auto">
  <name>Task 3: Generate type re-exports</name>
  <files>ferro-cli/src/commands/generate_types.rs, ferro-mcp/src/tools/generate_types.rs</files>
  <action>
  Add re-export generation so components can import all types from a single location.

  1. After the import statement in generated output, add re-export block:
     ```typescript
     // Re-exports from shared.ts for convenience
     export type { Type1, Type2, ... } from './shared';
     ```

  2. Re-export ALL types from shared.ts, not just referenced ones, for convenience
     - This allows components to import any type from inertia-props.ts
     - Pattern: `import type { UserProfile, Animal } from '../types/inertia-props'`

  3. Add CLI flag `--no-reexports` to disable if needed

  4. Update MCP generate_types.rs similarly

  AVOID: Duplicating logic between CLI and MCP - consider extracting shared utilities.
  WHY: Maintenance burden of keeping two implementations in sync.
  </action>
  <verify>
  - Generated TypeScript has re-export block
  - Re-exports include all types from shared.ts
  - `--no-reexports` flag disables re-exports
  - `cargo build --all` succeeds
  - `cargo test --all` passes
  </verify>
  <done>
  - Generated inertia-props.ts re-exports all types from shared.ts
  - Components can import shared types from inertia-props.ts
  - Optional --no-reexports flag available
  </done>
</task>
</tasks>

<verification>
Before declaring phase complete:
- [ ] `cargo build --all` succeeds
- [ ] `cargo test --all` passes
- [ ] `cargo clippy --all` passes
- [ ] `cargo fmt --check` passes
- [ ] Manual test: create sample InertiaProps with serde attributes, run `ferro generate-types`, verify output
</verification>

<success_criteria>
- Serde rename_all attributes are respected in generated TypeScript
- Referenced types from shared.ts are imported
- All shared.ts types are re-exported for convenience
- All tests pass
- No clippy warnings introduced
</success_criteria>

<output>
After completion, create `.planning/phases/22.4-type-generator-fixes/22.4-01-SUMMARY.md`
</output>
