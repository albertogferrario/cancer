---
phase: 08-mcp-generation-hints
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [cancer-mcp/src/tools/generation_context.rs, cancer-mcp/src/tools/code_templates.rs, cancer-mcp/src/tools/mod.rs, cancer-mcp/src/service.rs]
autonomous: true
---

<objective>
Add generation hint tools to cancer-mcp for agent code generation guidance.

Purpose: Enable AI agents to generate framework-appropriate code by providing conventions, patterns, templates, and anti-patterns in a structured format.
Output: Two new MCP tools: `generation_context` (conventions + patterns) and `code_templates` (copy-paste templates).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-mcp-generation-hints/08-RESEARCH.md

@cancer-mcp/src/service.rs
@cancer-mcp/src/tools/mod.rs
@cancer-mcp/src/tools/list_models.rs
@cancer-mcp/src/tools/get_handler.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement generation_context tool</name>
  <files>cancer-mcp/src/tools/generation_context.rs, cancer-mcp/src/tools/mod.rs</files>
  <action>
Create `generation_context.rs` that returns comprehensive framework conventions:

1. Define response structs:
```rust
pub struct GenerationContext {
    pub naming_conventions: NamingConventions,
    pub file_structure: FileStructure,
    pub common_patterns: CommonPatterns,
    pub avoid: Vec<String>,
    pub imports: ImportTemplates,
}
```

2. NamingConventions fields:
   - models: "PascalCase singular (User, BlogPost)"
   - tables: "snake_case plural (users, blog_posts)"
   - handlers: "snake_case verb (show, create, update, destroy)"
   - routes: "RESTful lowercase (GET /users, POST /users, GET /users/{id})"
   - middleware: "PascalCase (AuthMiddleware, RateLimitMiddleware)"
   - services: "PascalCase with trait+impl (UserService trait, PostgresUserService impl)"

3. FileStructure fields - describe expected file locations:
   - handlers: "src/controllers/{resource}.rs or src/handlers/{resource}.rs"
   - models: "src/models/{resource}.rs"
   - entities: "src/entities/{resource}.rs (SeaORM generated)"
   - migrations: "migration/src/m{timestamp}_{name}.rs"
   - middleware: "src/middleware/{name}.rs"
   - services: "src/services/{name}.rs"

4. CommonPatterns - include template snippets for:
   - crud_handler: Basic handler returning JSON
   - validation: Validator usage pattern
   - error_handling: Result return with proper error types
   - inertia_render: Inertia::render pattern with SavedInertiaContext

5. Avoid list - common mistakes:
   - "Don't use unwrap() in handlers - return proper Response errors"
   - "Don't skip validation for POST/PUT requests - use Validator"
   - "Don't hardcode configuration values - use Config"
   - "Don't use raw SQL when SeaORM queries work - prefer type-safe queries"
   - "Don't expose password_hash or sensitive fields in JSON responses"
   - "Don't forget SavedInertiaContext when consuming request before Inertia::render"

6. ImportTemplates - common import blocks for different contexts:
   - handler: "use cancer::prelude::*;"
   - model: "use sea_orm::entity::prelude::*;"
   - validation: "use cancer::validation::{Validator, rules};"

Export module in mod.rs.
  </action>
  <verify>cargo check -p cancer-mcp</verify>
  <done>generation_context.rs compiles and exports GenerationContext struct</done>
</task>

<task type="auto">
  <name>Task 2: Implement code_templates tool</name>
  <files>cancer-mcp/src/tools/code_templates.rs, cancer-mcp/src/tools/mod.rs</files>
  <action>
Create `code_templates.rs` that returns copy-paste code templates:

1. Define params and response:
```rust
pub struct CodeTemplatesParams {
    /// Template category: handler, model, migration, middleware, validation
    pub category: Option<String>,
}

pub struct CodeTemplates {
    pub templates: Vec<CodeTemplate>,
}

pub struct CodeTemplate {
    pub name: String,
    pub category: String,
    pub description: String,
    pub code: String,
    pub imports: Vec<String>,
    pub placeholders: Vec<Placeholder>,
}

pub struct Placeholder {
    pub name: String,
    pub description: String,
    pub example: String,
}
```

2. Include templates for each category:

**handler** templates:
- index_handler: List all resources with pagination
- show_handler: Get single resource by ID
- create_handler: Create with validation
- update_handler: Update with validation
- destroy_handler: Delete resource
- inertia_handler: Render Inertia component with props

**model** templates:
- entity_model: SeaORM DeriveEntityModel struct
- active_model: Mutation operations
- query_example: Common query patterns

**migration** templates:
- create_table: Basic table creation
- add_column: Add column to existing table
- create_index: Add index
- add_foreign_key: Add FK relationship

**middleware** templates:
- auth_middleware: Authentication check
- basic_middleware: Simple middleware structure

**validation** templates:
- form_validation: Full form validation with multiple fields
- field_rules: Common rule combinations

3. Each template includes:
   - Complete, working code
   - Required imports
   - Placeholders with descriptions (e.g., {{ModelName}}, {{table_name}})

4. Optional filter by category - if provided, only return templates matching that category.

Export module in mod.rs.
  </action>
  <verify>cargo check -p cancer-mcp</verify>
  <done>code_templates.rs compiles and exports CodeTemplates struct with all template categories</done>
</task>

<task type="auto">
  <name>Task 3: Register tools in service.rs</name>
  <files>cancer-mcp/src/service.rs</files>
  <action>
Add both tools to the MCP service:

1. Add param structs:
```rust
#[derive(Debug, Clone, Deserialize, Serialize, JsonSchema)]
pub struct GenerationContextParams {
    // No parameters - returns full context
}

#[derive(Debug, Clone, Deserialize, Serialize, JsonSchema)]
pub struct CodeTemplatesParams {
    /// Filter by category: handler, model, migration, middleware, validation
    pub category: Option<String>,
}
```

2. Add tool handlers with proper descriptions following existing pattern (When/Returns/Combine):

```rust
#[tool(
    name = "generation_context",
    description = "Get framework conventions, patterns, and anti-patterns for code generation.\n\n\
        **When to use:** Before generating new code, understanding Cancer framework patterns, \
        ensuring generated code follows conventions.\n\n\
        **Returns:** Naming conventions, file structure, common patterns, things to avoid, import templates.\n\n\
        **Combine with:** `code_templates` for copy-paste snippets, `list_models` for existing patterns."
)]
pub async fn generation_context(&self) -> String {
    let context = tools::generation_context::execute();
    serde_json::to_string_pretty(&context).unwrap_or_else(|_| "{}".to_string())
}

#[tool(
    name = "code_templates",
    description = "Get copy-paste code templates for common Cancer framework patterns.\n\n\
        **When to use:** Creating new handlers, models, migrations, or middleware from scratch.\n\n\
        **Returns:** Ready-to-use templates with placeholders, required imports, and usage notes.\n\n\
        **Combine with:** `generation_context` for conventions, `get_handler` for real examples."
)]
pub async fn code_templates(&self, params: Parameters<CodeTemplatesParams>) -> String {
    let templates = tools::code_templates::execute(params.0.category.as_deref());
    serde_json::to_string_pretty(&templates).unwrap_or_else(|_| "{}".to_string())
}
```

3. Update CANCER_MCP_INSTRUCTIONS constant to add "Code Generation" workflow and tool category:

Add workflow section:
```
## Generating New Code
1. `generation_context` - Get framework conventions and anti-patterns
2. `code_templates category:handler` - Get handler templates
3. Adapt template using naming conventions from step 1
4. `list_models` - Check existing patterns for consistency
```

Add to tool categories:
```
**Code Generation:**
- `generation_context` - Framework conventions and patterns
- `code_templates` - Copy-paste templates with placeholders
```
  </action>
  <verify>cargo check -p cancer-mcp && cargo test -p cancer-mcp</verify>
  <done>Both tools registered and accessible via MCP, instructions updated</done>
</task>

<task type="auto">
  <name>Task 4: Add unit tests</name>
  <files>cancer-mcp/src/tools/generation_context.rs, cancer-mcp/src/tools/code_templates.rs</files>
  <action>
Add tests to verify tool output:

1. generation_context tests:
   - test_generation_context_has_all_sections: Verify all fields populated
   - test_naming_conventions_complete: All naming categories present
   - test_avoid_list_not_empty: Anti-patterns included
   - test_serialization: JSON serialization works

2. code_templates tests:
   - test_all_categories_present: handler, model, migration, middleware, validation
   - test_filter_by_category: Category filter works correctly
   - test_templates_have_required_fields: Each template has code, imports, placeholders
   - test_handler_templates_count: At least 5 handler templates
   - test_serialization: JSON serialization works

Follow existing test patterns in cancer-mcp (see route_dependencies.rs tests).
  </action>
  <verify>cargo test -p cancer-mcp -- --nocapture</verify>
  <done>All new tests pass, total test count increased</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cargo check -p cancer-mcp` passes
- [ ] `cargo test -p cancer-mcp` passes (all tests including new ones)
- [ ] `cargo clippy -p cancer-mcp` passes without new warnings
- [ ] Both tools return valid JSON when called
</verification>

<success_criteria>
- All tasks completed with atomic commits
- generation_context returns complete framework conventions
- code_templates returns templates for all 5 categories
- Both tools follow existing description pattern (When/Returns/Combine)
- CANCER_MCP_INSTRUCTIONS updated with code generation workflow
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/08-mcp-generation-hints/08-01-SUMMARY.md`
</output>
