---
phase: 22.2-simplify-macro-crate-paths
plan: 01
subsystem: macros
tags: [proc-macro, quote, rust-macros, ferro-macros]

# Dependency graph
requires:
  - phase: 22.1-fix-macro-crate-path
    provides: proc-macro-crate solution (being replaced)
provides:
  - Simplified macro crate path using hardcoded ::ferro
  - Removed proc-macro-crate dependency
  - Updated sample app to use ferro alias
affects: [ferro-macros, app-sample, documentation]

# Tech tracking
tech-stack:
  added: []
  removed: [proc-macro-crate]
  patterns: [hardcoded crate path via quote!(::ferro)]

key-files:
  deleted:
    - ferro-macros/src/crate_path.rs
  modified:
    - ferro-macros/src/lib.rs
    - ferro-macros/src/injectable.rs
    - ferro-macros/src/test_macro.rs
    - ferro-macros/src/service.rs
    - ferro-macros/src/redirect.rs
    - ferro-macros/src/inertia.rs
    - ferro-macros/src/domain_error.rs
    - ferro-macros/src/cancer_test.rs
    - ferro-macros/src/handler.rs
    - ferro-macros/src/request.rs
    - ferro-macros/src/validate.rs
    - ferro-macros/src/model.rs
    - ferro-macros/Cargo.toml
    - docs/src/getting-started/installation.md
    - app/Cargo.toml
    - app/src/**/*.rs (19 files)

key-decisions:
  - "Hardcode ::ferro path instead of dynamic detection - simpler and sufficient"
  - "Sample app uses ferro alias via package = 'ferro-rs' for compatibility"
  - "All 11 macro files updated to use consistent ferro() helper pattern"

patterns-established:
  - "Macro files use ferro() helper returning quote!(::ferro)"
  - "Consumers must use 'ferro' as dependency name (or alias)"

# Metrics
duration: 35min
completed: 2026-01-17
---

# Phase 22.2: Simplify Macro Crate Paths Summary

**Removed proc-macro-crate dependency and hardcoded ::ferro path directly in all 11 macro files**

## Performance

- **Duration:** ~35 min
- **Tasks:** 5 + 2 additional (discovered 4 more macro files needing updates)
- **Files modified:** 35 (11 macro files, 1 Cargo.toml, 1 docs, 20 app files, 1 app Cargo.toml, 1 deleted)

## Accomplishments
- Removed crate_path.rs module entirely (dynamic crate name detection)
- Updated all 11 macro files to use hardcoded `quote!(::ferro)` pattern
- Removed proc-macro-crate dependency from Cargo.toml
- Removed "Dependency Naming" documentation section
- Updated sample app to use ferro alias for compatibility
- All verification checks pass (fmt, clippy, tests, app build)

## Task Commits

Each task was committed atomically:

1. **Task 1: Remove crate_path module** - `ee099c1` (refactor)
2. **Task 2: Update all macro files to use hardcoded path** - `7e2307e` (refactor)
3. **Task 3: Remove proc-macro-crate dependency** - `7a03e88` (chore)
4. **Task 4: Remove flexible naming documentation** - `54711e9` (docs)
5. **Task 5a: Standardize remaining macro files** - `d7e63ed` (refactor)
6. **Task 5b: Update app sample** - `b4142d1` (refactor)

## Files Created/Modified

**Deleted:**
- `ferro-macros/src/crate_path.rs` - Dynamic crate name detection module

**Modified (macro files - 11 total):**
- `ferro-macros/src/lib.rs` - Removed module declaration, updated doc examples
- `ferro-macros/src/injectable.rs` - Use hardcoded ferro path
- `ferro-macros/src/test_macro.rs` - Use hardcoded ferro path
- `ferro-macros/src/service.rs` - Use hardcoded ferro path
- `ferro-macros/src/redirect.rs` - Use hardcoded ferro path
- `ferro-macros/src/inertia.rs` - Use hardcoded ferro path
- `ferro-macros/src/domain_error.rs` - Use hardcoded ferro path
- `ferro-macros/src/cancer_test.rs` - Use hardcoded ferro path
- `ferro-macros/src/handler.rs` - Added ferro() helper, pass to generate_extraction
- `ferro-macros/src/request.rs` - Added ferro() helper
- `ferro-macros/src/validate.rs` - Added ferro() helper, pass to generate functions
- `ferro-macros/src/model.rs` - Added ferro() helper

**Modified (other):**
- `ferro-macros/Cargo.toml` - Removed proc-macro-crate dependency
- `docs/src/getting-started/installation.md` - Removed Dependency Naming section
- `app/Cargo.toml` - Changed to use ferro alias
- `app/src/**/*.rs` - 19 files changed from ferro_rs to ferro

## Decisions Made
- Hardcoding `::ferro` is sufficient - no need for dynamic detection
- Sample app updated to use `ferro = { path = "../framework", package = "ferro-rs" }` to work with hardcoded paths
- All macro files use consistent pattern: `let ferro = ferro();` where `ferro()` returns `quote!(::ferro)`

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 3 - Blocking] Additional macro files needed updates**
- **Found during:** Task 5 (Full verification)
- **Issue:** Four additional macro files (handler.rs, request.rs, validate.rs, model.rs) were using `ferro_rs` directly in quote strings instead of a variable
- **Fix:** Added ferro() helper function to each file and updated quote blocks to use #ferro::
- **Files modified:** handler.rs, request.rs, validate.rs, model.rs
- **Verification:** cargo build -p app succeeds
- **Committed in:** d7e63ed

**2. [Rule 3 - Blocking] Sample app needed crate alias**
- **Found during:** Task 5 (Full verification)
- **Issue:** Sample app used `ferro-rs` as dependency name, causing macros to fail (they emit ::ferro)
- **Fix:** Changed app/Cargo.toml to use `ferro = { path = "../framework", package = "ferro-rs" }` and updated all source files from ferro_rs to ferro
- **Files modified:** app/Cargo.toml, 19 app/src files
- **Verification:** cargo build -p app succeeds
- **Committed in:** b4142d1

---

**Total deviations:** 2 auto-fixed (both blocking)
**Impact on plan:** Both auto-fixes necessary for the simplification to work. Discovery of additional macro files using different patterns was expected complexity.

## Issues Encountered
- None beyond the auto-fixed deviations above

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- ferro-macros simplified and working
- Sample app demonstrates correct dependency configuration
- Ready for any future macro work

---
*Phase: 22.2-simplify-macro-crate-paths*
*Completed: 2026-01-17*
