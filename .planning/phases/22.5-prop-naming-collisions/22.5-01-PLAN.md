---
phase: 22.5-prop-naming-collisions
plan: 01
status: planned
---

<objective>
Resolve InertiaProps naming collisions and duplicate routes.ts entries by preserving module path context during code scanning.

Issues addressed:
- #3 InertiaProps Naming Collisions (High) - Multiple controllers have ShowProps, IndexProps collisions
- #2 Duplicate Properties in routes.ts (Medium) - Controllers like "dashboard" appear multiple times
</objective>

<execution_context>
@.planning/PROJECT.md
@.planning/phases/22.4-type-generator-fixes/22.4-01-SUMMARY.md
@.planning/phases/22.8-nested-types-generation/22.8-01-SUMMARY.md
</execution_context>

<context>
**Current Problem:**

1. **InertiaProps collisions**: `scan_inertia_props()` in `generate_types.rs` collects struct names without module path:
   - `shelter/applications.rs::ShowProps` and `adopter/applications.rs::ShowProps` both become `ShowProps`
   - TypeScript output has duplicate interface names or overwrites

2. **Routes.ts duplicates**: `extract_controller_name()` in `generate_routes.rs` only takes last path segment:
   - `controllers::shelter::dashboard` → `dashboard`
   - `controllers::adopter::dashboard` → `dashboard` (collision!)

**Solution approach:**
1. Capture module path during scanning
2. Auto-namespace TypeScript names using module path (e.g., `ShelterApplicationsShowProps`)
3. For routes, use full path for nested namespacing
</context>

<tasks>

<task id="1" effort="M">
<title>Add module path tracking to InertiaProps scanning</title>
<files>
- ferro-cli/src/commands/generate_types.rs
</files>
<description>
Modify `InertiaPropsStruct` and scanning logic to capture the module path where each struct is defined.

1. Add `module_path: String` field to `InertiaPropsStruct`
2. Update `InertiaPropsVisitor` to track current file path
3. Compute module path from file path (e.g., `src/controllers/shelter/applications.rs` → `shelter::applications`)
4. Pass module path when creating `InertiaPropsStruct` instances
</description>
</task>

<task id="2" effort="M" depends="1">
<title>Generate namespaced TypeScript interface names</title>
<files>
- ferro-cli/src/commands/generate_types.rs
</files>
<description>
Use module path to generate unique TypeScript interface names.

1. Add `generate_namespaced_name()` function that combines module path + struct name
   - `shelter::applications` + `ShowProps` → `ShelterApplicationsShowProps`
   - Use PascalCase for module segments, strip common prefixes like "controllers::"
2. Update `generate_typescript_interface()` to use namespaced name
3. Handle edge cases: root-level structs (no namespace), deeply nested modules
4. Add collision detection: if two structs produce same namespaced name, error with helpful message
</description>
</task>

<task id="3" effort="S">
<title>Sync ferro-mcp with namespaced generation</title>
<files>
- ferro-mcp/src/tools/generate_types.rs
- ferro-mcp/src/tools/list_props.rs
</files>
<description>
Update MCP tools to match CLI behavior.

1. Add `module_path` field to props structs in list_props.rs
2. Update generate_types.rs to use namespaced interface names
3. Ensure MCP output matches CLI output
</description>
</task>

<task id="4" effort="M">
<title>Fix routes.ts duplicate controller names</title>
<files>
- ferro-cli/src/commands/generate_routes.rs
</files>
<description>
Modify `extract_controller_name()` to preserve module hierarchy.

1. Change `extract_controller_name()` to keep parent segments after "controllers::"
   - `controllers::shelter::dashboard` → `shelter_dashboard`
   - `controllers::user` → `user` (no change for flat controllers)
2. Alternative: Generate nested object structure
   - `controllers.shelter.dashboard.index()` instead of `controllers.dashboard.index()`
3. Add collision detection with helpful error message
4. Update TypeScript template to handle nested structure if chosen
</description>
</task>

<task id="5" effort="S">
<title>Add tests for namespacing</title>
<files>
- ferro-cli/src/commands/generate_types.rs
- ferro-cli/src/commands/generate_routes.rs
</files>
<description>
Add comprehensive tests for the new namespacing logic.

1. Test module path extraction from file paths
2. Test namespaced name generation
3. Test collision detection and error messages
4. Test routes.ts with nested controllers
5. Test edge cases: single-level modules, deeply nested, special characters
</description>
</task>

</tasks>

<verification>
```bash
# Build
cargo build --all

# Tests
cargo test -p ferro-cli -p ferro-mcp

# Lint
cargo clippy --all -- -D warnings

# Format
cargo fmt --check
```
</verification>

<success_criteria>
- [ ] `InertiaPropsStruct` includes module path information
- [ ] Generated TypeScript interfaces have unique namespaced names
- [ ] Collision detection with helpful error messages
- [ ] routes.ts has no duplicate controller keys
- [ ] MCP tools synced with CLI behavior
- [ ] All tests pass
- [ ] No clippy warnings
</success_criteria>

<output>
Commits (atomic, one per task):
1. `feat(generate-types): add module path tracking to InertiaProps scanning`
2. `feat(generate-types): generate namespaced TypeScript interface names`
3. `feat(ferro-mcp): sync namespaced type generation`
4. `feat(generate-routes): fix duplicate controller names with hierarchy`
5. `test(generate-types): add namespacing tests`

Update .planning/STATE.md with phase completion.
Create SUMMARY.md documenting changes and decisions.
</output>
