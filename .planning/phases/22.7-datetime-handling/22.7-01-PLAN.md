---
phase: 22.7-datetime-handling
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - ferro-cli/src/commands/generate_types.rs
  - ferro-mcp/src/tools/generate_types.rs
autonomous: true
---

<objective>
Add datetime type support to the TypeScript generator so chrono types map to `string` (ISO8601 format) instead of falling through to Custom().

Purpose: When InertiaProps contain DateTime, NaiveDateTime, NaiveDate, NaiveTime, or DateTimeUtc fields, the generated TypeScript should use `string` type, matching how serde serializes chrono types to ISO8601 strings.
Output: Type generator recognizes chrono datetime types and generates `string` TypeScript type
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/backlog/adotta-animali-issues.md (Issue #6: Inconsistent Date/Time Field Handling)
@ferro-cli/src/commands/generate_types.rs (lines 106-114 RustType enum, lines 232-305 parse_type fn)
</context>

<tasks>
<task type="auto">
  <name>Task 1: Add DateTime variant to RustType enum</name>
  <files>ferro-cli/src/commands/generate_types.rs</files>
  <action>
    Add a `DateTime` variant to the `RustType` enum (around line 107).

    The enum currently has: String, Number, Bool, Option, Vec, HashMap, Custom.
    Add: `DateTime` variant (no inner type needed - all datetime types serialize to ISO8601 strings).

    Update `rust_type_to_typescript()` function to map `RustType::DateTime` to `"string"`.
    This matches how chrono types serialize via serde - they become ISO8601 strings in JSON.
  </action>
  <verify>cargo build -p ferro-cli succeeds</verify>
  <done>RustType enum has DateTime variant, rust_type_to_typescript maps it to "string"</done>
</task>

<task type="auto">
  <name>Task 2: Update parse_type to recognize chrono types</name>
  <files>ferro-cli/src/commands/generate_types.rs</files>
  <action>
    Modify the `parse_type()` function (around line 232-305) to recognize chrono datetime types.

    Add cases before the `other => RustType::Custom(other.to_string())` fallback (line 285):

    Match these type identifiers:
    - "DateTime" → RustType::DateTime (chrono::DateTime<T>)
    - "NaiveDateTime" → RustType::DateTime
    - "NaiveDate" → RustType::DateTime
    - "NaiveTime" → RustType::DateTime
    - "DateTimeUtc" → RustType::DateTime (SeaORM's alias)
    - "DateTimeLocal" → RustType::DateTime
    - "Date" → RustType::DateTime (SeaORM types)
    - "Time" → RustType::DateTime

    Note: DateTime<Tz> has a generic parameter but we only need the outer type name since all datetime types serialize to strings regardless of timezone.

    Place these cases in the match arm between "ValidationErrors" (line 281-284) and the `other` fallback (line 285).
  </action>
  <verify>cargo build -p ferro-cli succeeds</verify>
  <done>parse_type recognizes DateTime, NaiveDateTime, NaiveDate, NaiveTime, DateTimeUtc, DateTimeLocal, Date, Time and returns RustType::DateTime</done>
</task>

<task type="auto">
  <name>Task 3: Add tests for datetime type handling</name>
  <files>ferro-cli/src/commands/generate_types.rs</files>
  <action>
    Add tests in the `#[cfg(test)]` module at the bottom of the file.

    Test cases:
    1. `test_datetime_type_mapping` - Verify DateTime, NaiveDateTime, NaiveDate, NaiveTime map to RustType::DateTime
    2. `test_datetime_to_typescript` - Verify RustType::DateTime generates "string" in TypeScript
    3. `test_option_datetime` - Verify Option<DateTime<Utc>> generates "string | null"
    4. `test_vec_datetime` - Verify Vec<NaiveDateTime> generates "string[]"
    5. `test_generate_typescript_with_datetime` - End-to-end test with a props struct containing datetime fields

    Follow existing test patterns in the file (e.g., test_serde_case_from_str, test_generate_typescript_with_serde).
  </action>
  <verify>cargo test -p ferro-cli datetime passes</verify>
  <done>All datetime-related tests pass, covering type mapping, TypeScript generation, and composite types</done>
</task>

<task type="auto">
  <name>Task 4: Sync MCP tool with CLI changes</name>
  <files>ferro-mcp/src/tools/generate_types.rs</files>
  <action>
    Update ferro-mcp's generate_types.rs to match the CLI changes.

    The MCP crate has its own copy of the type generation logic. Apply the same changes:
    1. Add DateTime variant to RustType enum
    2. Update parse_type() to recognize chrono types
    3. Update rust_type_to_typescript() to map DateTime to "string"

    Keep the implementations in sync between ferro-cli and ferro-mcp.
  </action>
  <verify>cargo build -p ferro-mcp succeeds</verify>
  <done>ferro-mcp generate_types matches ferro-cli datetime handling</done>
</task>

<task type="auto">
  <name>Task 5: Run full test suite and format check</name>
  <files>N/A</files>
  <action>
    Run the complete verification suite:
    1. cargo fmt --check (formatting)
    2. cargo clippy --all -- -D warnings (lints)
    3. cargo test -p ferro-cli -p ferro-mcp (both affected crates)
    4. cargo build --all (full workspace build)

    Fix any issues before committing.
  </action>
  <verify>All commands pass without errors or warnings</verify>
  <done>Full test suite passes, code is formatted, no clippy warnings</done>
</task>

<task type="auto">
  <name>Task 6: Commit changes</name>
  <files>N/A</files>
  <action>
    Create a single commit with all changes:

    Subject: feat(generate-types): add chrono datetime type support

    Body should mention:
    - Added DateTime variant to RustType enum
    - Recognized chrono types: DateTime, NaiveDateTime, NaiveDate, NaiveTime, DateTimeUtc, DateTimeLocal, Date, Time
    - All datetime types map to TypeScript "string" (ISO8601 serialization)
    - Addresses Issue #6 from adotta-animali port
  </action>
  <verify>git log -1 shows the commit</verify>
  <done>Changes committed with descriptive message</done>
</task>
</tasks>

<verification>
Before declaring phase complete:
- [ ] cargo build --all succeeds without errors
- [ ] cargo test -p ferro-cli -p ferro-mcp passes all tests
- [ ] cargo clippy --all -- -D warnings passes
- [ ] cargo fmt --check passes
- [ ] DateTime<Utc> in InertiaProps generates `string` in TypeScript
- [ ] Option<NaiveDateTime> generates `string | null`
- [ ] Vec<NaiveDate> generates `string[]`
</verification>

<success_criteria>
- RustType enum has DateTime variant
- parse_type() recognizes all common chrono types
- rust_type_to_typescript() maps DateTime to "string"
- Both ferro-cli and ferro-mcp updated consistently
- Tests cover datetime type mapping and generation
- All verification checks pass
</success_criteria>

<output>
After completion, create `.planning/phases/22.7-datetime-handling/22.7-01-SUMMARY.md`
</output>
