---
phase: 22.9-validation-errors-type
plan: 01
type: feature
wave: 1
depends_on: []
files_modified:
  - ferro-cli/src/commands/generate_types.rs
  - ferro-mcp/src/tools/generate_types.rs
autonomous: true
---

<objective>
Add special handling for `ValidationErrors` type in the type generator so it maps to `Record<string, string[]>` in TypeScript instead of `unknown`.

Currently, validation errors use `Option<serde_json::Value>` which generates `unknown | null`. With the existing `ferro::ValidationErrors` type (a `HashMap<String, Vec<String>>`), developers should be able to use it directly and get proper TypeScript types.
</objective>

<execution_context>
@ferro-cli/src/commands/generate_types.rs
@ferro-mcp/src/tools/generate_types.rs
@framework/src/error.rs
</execution_context>

<context>
**Prior art:**
@.planning/phases/22.4-type-generator-fixes/22.4-01-SUMMARY.md
@.planning/phases/22.8-nested-types-generation/22.8-01-SUMMARY.md

**Existing ValidationErrors type:**
```rust
// framework/src/error.rs
pub struct ValidationErrors {
    pub errors: HashMap<String, Vec<String>>,
}
```

Already exported from `ferro::ValidationErrors`.

**Current behavior:**
- `Option<serde_json::Value>` → TypeScript `unknown | null`
- No special handling for `ValidationErrors`

**Target behavior:**
- `Option<ValidationErrors>` → TypeScript `Record<string, string[]> | null`
- `ValidationErrors` → TypeScript `Record<string, string[]>`
</context>

<task id="1" title="Add ValidationErrors handling in CLI type generator">
**Goal:** Recognize `ValidationErrors` type and map to proper TypeScript Record type.

**Files:**
- ferro-cli/src/commands/generate_types.rs

**Implementation:**

1. Update `parse_type()` to recognize `ValidationErrors` (and variants like `ferro::ValidationErrors`):
   ```rust
   // In parse_type(), before the default Custom case:
   "ValidationErrors" | "ferro::ValidationErrors" => {
       RustType::HashMap(
           Box::new(RustType::String),
           Box::new(RustType::Vec(Box::new(RustType::String)))
       )
   }
   ```

2. This leverages existing `rust_type_to_ts()` HashMap handling:
   ```rust
   RustType::HashMap(key, val) => format!("Record<{}, {}>", rust_type_to_ts(key), rust_type_to_ts(val))
   ```
   Which will produce: `Record<string, string[]>`

**Tests:**
Add test case:
```rust
#[test]
fn test_parse_type_validation_errors() {
    assert_eq!(
        parse_type("ValidationErrors"),
        RustType::HashMap(
            Box::new(RustType::String),
            Box::new(RustType::Vec(Box::new(RustType::String)))
        )
    );
    assert_eq!(
        parse_type("ferro::ValidationErrors"),
        RustType::HashMap(
            Box::new(RustType::String),
            Box::new(RustType::Vec(Box::new(RustType::String)))
        )
    );
}

#[test]
fn test_validation_errors_to_ts() {
    let ty = parse_type("ValidationErrors");
    assert_eq!(rust_type_to_ts(&ty), "Record<string, string[]>");
}
```

**Verify:** `cargo test -p ferro-cli`
</task>

<task id="2" title="Sync ValidationErrors handling to ferro-mcp">
**Goal:** Apply same ValidationErrors recognition to MCP type generator.

**Files:**
- ferro-mcp/src/tools/generate_types.rs

**Implementation:**

Apply same pattern as Task 1 to the MCP type generator. Look for:
- `parse_type()` or equivalent function
- Add `ValidationErrors` recognition before default case

The MCP uses regex-based parsing, so the pattern may differ slightly. Match the approach used for other special types.

**Verify:** `cargo test -p ferro-mcp`
</task>

<task id="3" title="Verify complete solution">
**Goal:** Ensure all tests pass and code quality checks succeed.

**Verification:**
```bash
cargo build --all
cargo test -p ferro-cli -p ferro-mcp
cargo clippy --all -- -D warnings
cargo fmt --check
```

All must pass.
</task>

<verification>
```bash
cargo build --all                      # Must compile
cargo test -p ferro-cli -p ferro-mcp   # All tests pass
cargo clippy --all -- -D warnings      # No warnings
cargo fmt --check                      # Properly formatted
```
</verification>

<success_criteria>
- [ ] `parse_type("ValidationErrors")` returns HashMap(String, Vec(String))
- [ ] `parse_type("ferro::ValidationErrors")` returns same
- [ ] Generated TypeScript shows `Record<string, string[]>` for ValidationErrors fields
- [ ] ferro-mcp synced with same behavior
- [ ] All tests pass
- [ ] Clippy clean
</success_criteria>

<output>
Commit: `feat(generate-types): add ValidationErrors type handling`

Summary file: 22.9-01-SUMMARY.md documenting:
- ValidationErrors recognition added to parse_type()
- Maps to Record<string, string[]> in TypeScript
- Both CLI and MCP updated
</output>
